# Homework 16: Stored Procedures

## Objectives

- Write stored procedures to encapsulate library operations
- Use input and output parameters
- Employ variables and control flow inside procedures

## Instructions

Answer the conceptual questions in a Markdown file (`hw16_answers.md`) and implement the stored procedures in a SQL script (`hw16.sql`).

### Conceptual Questions

1. **Purpose of Stored Procedures**  
   Explain how stored procedures differ from running raw SQL from an application and list two benefits they provide.
2. **Parameter Types**  
   Describe the difference between `IN`, `OUT`, and `INOUT` parameters. Provide a library-related scenario for each.
3. **Control Flow**  
   When would you use conditional logic (`IF`/`ELSE`) or loops inside a stored procedure? Give one example.
4. **Security Advantages**  
   How can stored procedures help enforce security or permissions in a database-driven application?
5. **Maintenance Trade-offs**  
   What is one challenge stored procedures introduce for long-term maintenance or deployment?

### Practical Exercises

1. **Add Member Procedure**
   - Create `add_member(IN p_name VARCHAR(255), IN p_email VARCHAR(255))`.
   - Inserts a row into `members` with the provided name and email.
2. **Checkout Book Procedure**
   - Create `checkout_book(IN p_member_id INT, IN p_book_id INT, IN p_due_days INT)`.
   - Inserts into `checkouts` with `checkout_date = CURRENT_DATE` and `due_date = CURRENT_DATE + INTERVAL p_due_days DAY`.
3. **Return Book Procedure**
   - Create `return_book(IN p_checkout_id INT)`.
   - Sets `returned_at = CURRENT_DATE` for the given checkout if it is still outstanding.
4. **Member Overdue Count**
   - Create `member_overdue_count(IN p_member_id INT, OUT p_total INT)`.
   - Counts how many of the memberâ€™s checkouts are past due (`due_date < CURRENT_DATE AND returned_at IS NULL`) and stores the result in `p_total`.
5. **Renew Checkout Procedure**
   - Create `renew_checkout(IN p_checkout_id INT, IN p_extra_days INT)`.
   - If the book has not been returned, extend its `due_date` by `p_extra_days`; otherwise do nothing.
6. **Calculate Late Fee**
   - Create `calculate_late_fee(IN p_checkout_id INT, IN p_daily_fee DECIMAL(5,2), OUT p_fee DECIMAL(5,2))`.
   - If the checkout is overdue, set `p_fee` to days overdue multiplied by `p_daily_fee`; otherwise return 0.

## Submission

- Save your conceptual answers in `hw16_answers.md` and your procedures in `hw16.sql`.
- Place both files in: `submissions/homework_16/<your-github-username>/`.
- Submit a pull request as described in the [submissions README](../submissions/README.md).

## Example Directory Structure

```
submissions/
  homework_16/
    your-github-username/
      hw16_answers.md
      hw16.sql
```

## Tips

- Use `DELIMITER` to define procedures that contain multiple statements.
- Test each procedure with sample data before submission.
- Include comments (`--`) to label each answer.
