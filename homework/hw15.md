# Homework 15: Views & Triggers

Use the existing library schema (`books`, `authors`, `book_authors`, `members`, `checkouts`, `reviews`, `profiles`). Create a new SQL file `hw15.sql` that answers the questions below. Precede each answer with a comment describing the task.

## Questions

1. **Overdue Books View**  
   Create a view `overdue_checkouts` listing member name, book title, due date, and days overdue for all checkouts where `returned_at` is `NULL` and `due_date` is past today. Query the view to return all rows.

2. **Author Popularity View**  
   Build a view `author_popularity` that counts total checkouts for each author by joining `book_authors` and `checkouts`. Select the top 5 authors ordered by checkout count.

3. **Review Summary View**  
   Make a view `book_reviews_summary` showing each bookâ€™s average rating and review count. Retrieve books with an average rating above 4.

4. **Checkout Audit Trigger**  
   Create a table `checkout_audit` with columns: `checkout_id`, `action`, `changed_at` (timestamp).  
   Write an `AFTER INSERT` trigger on `checkouts` that inserts a row into `checkout_audit` when a new checkout occurs.

5. **Return Update Trigger**  
   Write an `AFTER UPDATE` trigger on `checkouts` that fires when `returned_at` changes from `NULL` to a value. Insert a row into `checkout_audit` with action `RETURNED` and the checkout id.

6. **Prevent Past Due Date Trigger**  
   Add a `BEFORE INSERT` trigger on `checkouts` that ensures `due_date` is not more than 30 days after `checkout_date`. If it exceeds, set `due_date` to 30 days after `checkout_date`.

7. **Cleanup**  
   Provide `DROP VIEW` and `DROP TRIGGER` statements for everything you created so the script can be rerun.

## Submission
- Save your solutions in `hw15.sql`.
- Place the file in `submissions/homework_15/<your-github-username>/`.
- Submit a pull request with the SQL file and a short explanation of your approach.

