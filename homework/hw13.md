# Homework 13: CTEs

## Objectives

- Practice defining and reusing Common Table Expressions
- Use multiple CTEs to build layered logic
- Write recursive CTEs for generating sequences and reports
- Compare solutions using CTEs with equivalent subquery approaches

## Instructions

Write a SQL script (`hw13.sql`) that answers the following questions using your existing **library schema** and data from previous homeworks. Include a comment with the question number and a brief description before each answer.

### Questions

1. **Recent Checkouts**
   - Build a CTE `recent_checkouts` that lists all checkouts from the last 30 days.
   - Return each member’s name, the book title, and the checkout date.

2. **Average Rating per Book**
   - Use a CTE `book_ratings` to compute the average rating of each book from the `reviews` table.
   - Select books with an average rating above 4.0, returning title and average rating.

3. **Top Authors by Checkouts**
   - First CTE: count checkouts per book (`book_checkout_counts`).
   - Second CTE: join that count to `book_authors` to produce `author_checkout_totals`.
   - Final query: list authors and total checkouts, ordered by highest totals.

4. **Members Without Recent Activity**
   - Create a CTE that finds each member’s most recent checkout date.
   - Return names of members whose last checkout was more than six months ago.

5. **Overdue Books**
   - Build a CTE of checkouts where `due_date < CURRENT_DATE` and `returned_at` is `NULL`.
   - Return member name, book title, and days overdue.

6. **Recursive Date Series**
   - Using `WITH RECURSIVE`, generate all dates in January 2025.
   - Left join to `checkouts` to count how many checkouts occurred each day.

7. **Compare Approaches**
   - Solve “members who have written at least one review” twice:
     - Once with a CTE.
     - Once with a traditional subquery.
   - Note differences in clarity or execution.

## Submission

- Save your SQL queries in a file named `hw13.sql`.
- Place the file in: `submissions/homework_13/<your-github-username>/`.
- Submit a pull request as described in the [submissions README](../submissions/README.md).

## Example Directory Structure

```
submissions/
  homework_13/
    your-github-username/
      hw13.sql
```

## Tips

- Use comments (`--`) to label each query.
- Reuse CTEs in subsequent queries when possible.
- For recursive CTEs, always include a termination condition.
- Compare execution plans (`EXPLAIN`) when evaluating CTE vs. subquery performance.

